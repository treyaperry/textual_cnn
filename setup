#!/usr/bin/env bash

trap 'echo -e "\n${RED}Error occurred. Press Enter to exit...${NC}"; read' ERR
set -e

echo "================================================"
echo "  Textual CNN Project Setup"
echo "================================================"
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Create virtual environment
if [ ! -d "venv" ]; then
    echo ""
    echo "Creating virtual environment..."
    python3 -m venv venv
    echo -e "${GREEN}Virtual environment created.${NC}"
else
    echo -e "${YELLOW}Virtual environment already exists. Skipping creation.${NC}"
fi

# Activate virtual environment
echo ""
echo "Activating virtual environment..."
source venv/bin/activate
echo -e "${GREEN}Virtual environment activated.${NC}"

# Upgrade pip
echo ""
echo "Upgrading pip, setuptools, wheel..."
python3 -m pip install --upgrade pip setuptools wheel
echo -e "${GREEN}Pip, setuptools, and wheel upgraded.${NC}"

# Install required packages
echo ""
echo "Installing required packages..."
python3 -m pip install -r venvrequirements.txt
echo -e "${GREEN}Required packages installed.${NC}"

# Check for Kaggle API credentials
if [ -z "$KAGGLE_API_TOKEN" ]; then
    echo -e "${RED}Error: KAGGLE_API_TOKEN environment variable is not set."
    echo -e "${YELLOW}Please set the KAGGLE_API_TOKEN environment variable with your Kaggle API token.${NC}"
    echo ""
    echo "To set up Kaggle authentication:"
    echo "1. Visit https://www.kaggle.com/settings/"
    echo "2. Scroll to 'API' section and click 'Create New Token'"
    echo "3. Add the token to your environment:"
    echo "   echo 'export KAGGLE_API_TOKEN=YOUR_TOKEN_HERE' >> ~/.bash_profile"
    echo "   source ~/.bash_profile"
    echo ""
    exit 1
fi

# Download dataset from Kaggle
python3 scripts/download_ai_human_dataset.py

echo ""
echo "================================================"
echo -e "${GREEN}  Setup Complete!${NC}"
echo "================================================"
echo ""
echo "To activate the virtual environment in the future:"
echo "  source venv/bin/activate"
echo ""
